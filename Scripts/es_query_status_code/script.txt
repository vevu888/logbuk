#!/bin/bash

# Developed by George Focsa - Log-Analysis Team
# Rename the file so it ends with .sh extension

now=$(date +%Y.%m.%d)

curl -s -o /dev/null -w "%{http_code}\n" \
-X POST http://127.0.0.1:9200/ltds-$now-v002/_search?pretty=true \
-H 'Content-Type: application/json' -d \
'{ \
    "size": 0, \
    "query": { \
        "terms": { \
            "header.resource.id": ["*BT20","*BT21","*BT22"] \ 
        } \
    }, \
    "aggs": { \
        "group_by_head_res_id": { \
            "terms": { \
                "field": "header.resource.id", \
                "size": 0 \
            }, \
            "aggs": { \
                "top_hits_head_res_id": { \
                    "top_hits": { \
                        "size": 1 \
                    } \
                } \
            } \
        } \
    } \
}'