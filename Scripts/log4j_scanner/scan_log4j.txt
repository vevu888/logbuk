#!/bin/bash

#########################################################
#   Scan systems for the Log4j CVE-2021-44228 exploit   #
#                                                       #
#   Developed by George Focsa - Luxoft                  #
#########################################################

echo ' '
echo '=========== Checking for log4j vulnerability. ===========';
echo ' ';
echo '[info] This might take some time'
echo '[info] We scan /etc, /usr and /var'
echo ' '

if [ "$(grep -H -I -r -s 'log4j' /etc)" ]; then
    echo ' ';
    echo "[warn] Possibly vulnerable (/etc), check details_etc.log";
    grep -H -I -r -s 'log4j' /etc > details_etc.log
    echo ' ';
fi;

if [ "$(grep -H -I -r -s 'log4j' /usr)" ]; then
    echo "[warn] Possibly vulnerable (/usr), check details_usr.log";
    grep -H -I -r -s 'log4j' /usr > details_usr.log
    echo ' ';
fi;

if [ "$(grep -H -I -r -s 'log4j' /var)" ]; then
    echo "[warn] Possibly vulnerable (/var), check details_var.log";
    grep -H -I -r -s 'log4j' /var > details_var.log
    echo ' ';
fi;

if [ '$(which java)' ]; then
    echo '[info] Java is installed.';
    echo '[info] log4j could be bundled in apps that use Java'
    echo ' ';
fi;

if [ -s details_etc.log ] || [ -s details_usr.log ] || [ -s details_var.log ]; then
    echo '[warn] The system is possibly vulnerable to log4j exploit.';
    echo ' ';
    echo '[info] Check the log files created';
    echo ' ';
    echo '=========================================================';
    echo ' ';
else
    echo '[info] The system is not vulnerable to log4j exploit';
    echo ' ';
    echo '=========================================================';
    echo ' ';
fi;
